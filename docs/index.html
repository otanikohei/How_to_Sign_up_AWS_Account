
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>AWSアカウントを作成してみよう～ Presented by JAWS-UG 初心者支部 ２０２２</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="AWSアカウントを作成してみよう～ Presented by JAWS-UG 初心者支部 ２０２２"
                  environment="web"
                  feedback-link="https://github.com/otanikohei/How_to_Sign_up_AWS_Account/settings">
    
      <google-codelab-step label="はじめに" duration="5">
        <p class="image-container"><img alt="扉絵" src="img/c3b1ad667840206d.gif"></p>
<p>本ハンズオンは以下のような方をターゲットにしています。</p>
<ul>
<li>AWS アカウントを契約して使いたいけど、具体的な手順や詳細が分からない</li>
<li>手順は知っているけど、操作方法が分からなくなったときに質問できないのは不安</li>
<li>課金システムが分からない、高額請求が怖い</li>
</ul>
<h2 is-upgraded>前提や注意点</h2>
<aside class="warning"><p>アカウント作成の注意点についてはできる限り配慮していますが、保証・補償をする物ではございません。 </p>
</aside>
<aside class="warning"><p>アカウント作成した後、運用次第では費用が発生する可能性があります。</p>
</aside>
<h2 is-upgraded>ご用意いただきたいもの</h2>
<p class="image-container"><img alt="マストアイテム" src="img/f1d742716d4d9d9e.png"></p>
<ul>
<li>メールアドレス</li>
<li>クレジットカード／デビットカード</li>
<li>SMS (ショートメッセージサービス) が届く携帯電話やスマートホンなどの機器</li>
<li>Google Authenticator</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="AWS の無料利用枠について" duration="0">
        <p>AWS には無料利用枠があります。一部のサービスが一定額まで無料であったり、期間限定で無料で体験できます。</p>
<p><a href="https://aws.amazon.com/jp/free" target="_blank">https://aws.amazon.com/jp/free</a></p>
<p>以下は、無料枠の一部ですが有効期限が 12 ヶ月のものが多いので使えるうちに色々試してしまいましょう！</p>
<p class="image-container"><img alt="無料枠の例" src="img/58921d54c1f33961.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="AWS アカウント作成の流れ" duration="0">
        <p>Amazon Web Services (AWS) を利用するには、AWS アカウントの契約が必要です。</p>
<p>以下リンクをクリックすると、AWS アカウントを作る方法が画面のスクリーンキャプチャー付きで紹介されています。<br> まずは、この手順に沿ってアカウントを作成してください。</p>
<p><a href="https://aws.amazon.com/jp/register-flow/" target="_blank">https://aws.amazon.com/jp/register-flow/</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="サインイン" duration="0">
        <p>アカウントができたらサインインしてみましょう。<br> 以下 URL からサインインできます。</p>
<p><a href="https://signin.aws.amazon.com/console" target="_blank">https://signin.aws.amazon.com/console</a></p>
<p>以下の画面がサインイン画面が表示されたら、</p>
<p class="image-container"><img alt="サインイン画面" src="img/e7529d373baae86d.png"></p>
<p>「ルートユーザーの E メールを使用したサインイン」のリンクをクリックしてください。</p>
<p class="image-container"><img alt="ルートユーザーの E メールを使用したサインイン" src="img/2042febc3baeb9ff.png"></p>
<p>以下の画面に遷移しますので、[ <strong>○ ルートユーザー</strong> ] が選択されていることを確認し、<strong>ルートユーザーの E メールアドレス</strong> にメールアドレスを入力して、[ <strong>次へ</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="ルートユーザーを選択して、メールアドレスを入力" src="img/e13ee0adca4bfab4.png"></p>
<p>パスワードを入力する画面に遷移しますので、先ほどの <strong>アカウント作成手順</strong> にて設定したパスワードでサインインしてください。</p>
<p class="image-container"><img alt="パスワード入力" src="img/4addfbab5e104d3e.png"></p>
<p>以下の画面が表示されたらサインイン成功です。</p>
<p class="image-container"><img alt="サインイン成功" src="img/45f4f24f8d787e82.png"></p>
<p>今後、他のハンズオンで「コンソール画面を開いて」と言われた場合は、この画面、またはこの画面から遷移する AWS サービスの画面のことだ、とご認識ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="マネジメントコンソールの構成" duration="0">
        <p>マネジメントコンソールの画面の構成について簡単に説明します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソールの構成" src="img/164db95dbe0a0eff.png"></p>
<ol type="1">
<li>左上の AWS のロゴをクリックすると、トップページが表示されます。<br><img alt="AWS マネジメントコンソールの構成" src="img/73772a0488748600.png"></li>
<li>サービスをクリックすると、サービスの一覧が表示されます。<br><img alt="AWS マネジメントコンソールの構成" src="img/886ea956fb3f904e.gif"></li>
<li>テキストボックスにキーワードを入力すると候補が表示されます。例えば、api と入力すると、API Gateway が一番に表示され、次候補に API を記録する CloudTrail が表示されます。 <img alt="AWS マネジメントコンソールの構成" src="img/9d564ddc8f4b5deb.png"></li>
<li>CloudShell のアイコンです。本ハンズオンでは取り上げませんが、AWS CLI を実行できます。 <img alt="AWS マネジメントコンソールの構成" src="img/becc394c244b2c0e.png"></li>
<li>パーソナルヘルスダッシュボードです。メンテナンスのお知らせや障害などが通知されます。 <img alt="AWS マネジメントコンソールの構成" src="img/e9a0d1e0fc0ecbc2.png"></li>
<li>サポートセンター へのリンクや、AWS IQ というエキスパートとコンタクトを取るためのツール、re:Post というフォーラムなどにアクセスができます。 <img alt="AWS マネジメントコンソールの構成" src="img/31e844f9a3e8e807.png"></li>
<li>アカウント名をクリックすると、請求情報やセキュリティ情報、アカウント情報にアクセスできます。 <img alt="AWS マネジメントコンソールの構成" src="img/26fed5d4af511042.png"></li>
</ol>
<aside class="special"><p>アカウント 名をクリックすると、12 桁のアカウント ID が表示されますので、控えておいてください。後ほど使用します。</p>
</aside>
<h2 is-upgraded>リージョンとアベイラビリティゾーン (AZ)</h2>
<p>AWS クラウドは、2022年8月現在、全世界 26 の地域にある 84 のアベイラビリティーゾーンにまたがっており、24 アベイラビリティーゾーンと 8 AWS リージョンを追加する計画が発表されています。</p>
<p>AWS のリージョンは必ず複数のデータセンタークラスタ（=AZ）で構成されています。 各 AZ 間は数十キロ離れ、電源やネットワークが独立しており、高い耐障害性を提供できる設計になっています。</p>
<p><a href="https://aws.amazon.com/jp/about-aws/global-infrastructure/" target="_blank">AWS グローバルインフラストラクチャマップ</a></p>
<p class="image-container"><img alt="リージョンを変更" src="img/1d06a553c563f54f.gif"></p>
<h3 is-upgraded>リージョンを変更する (シンガポール)</h3>
<p>AWS マネジメントコンソールに初めてサインインすると、「<strong>バージニア北部</strong>」リージョンが表示されます。練習で、シンガポールリージョンに移動してみたいと思います。</p>
<p>このリージョン名をクリックして候補から、[ <strong>アジアパシフィック (シンガポール) ap-southeast-1</strong> ] を選択してください。</p>
<p class="image-container"><img alt="リージョンを変更" src="img/3700938d3ca7b58f.png"></p>
<h3 is-upgraded>リージョンを変更する (シドニー)</h3>
<p>画面遷移して「シンガポール」リージョンが表示されたら、次は「シドニー」リージョンに移動してみてください。<strong>シンガポール</strong> をクリックし、[ <strong>アジアパシフィック (シドニー) ap-southeast-2</strong> ] を選択してください。</p>
<p class="image-container"><img alt="リージョンを変更" src="img/9e4eadeb8b92bacc.png"></p>
<h3 is-upgraded>リージョンを変更する (東京)</h3>
<p>リージョンの移動は完璧でしょうか。</p>
<p>それでは、本日構築する「東京」リージョンに移動してください。「シドニー」をクリックし、[ <strong>アジアパシフィック (東京) ap-northeast-1</strong> ] を選択してください。</p>
<p class="image-container"><img alt="リージョンを変更" src="img/ef9f5ab4fe731e68.png"></p>
<h3 is-upgraded>デフォルトリージョンを設定する</h3>
<p>AWS マネジメントコンソールは「最後に利用したリージョン」を表示するようになっています。</p>
<p>これを変更するには、[設定] を開き、デフォルトリージョン の「最後に使用したリージョン」から希望のリージョンに変更してください。</p>
<p class="image-container"><img alt="リージョンを変更" src="img/29f05bf73e7eabcc.png"></p>
<h2 is-upgraded>リージョンのオプトイン方法</h2>
<p>香港以降のリージョンは、デフォルトで無効になっておりアカウントから有効 (オプトイン) にする必要があります。</p>
<p>右上のアカウント名をクリックして、<strong>アカウント</strong> を選択します。</p>
<p class="image-container"><img alt="アカウント" src="img/8fbab37fce125f37.png"></p>
<p>遷移したページの中断に表示される AWS リージョンで無効のものが有効に変更できます。</p>
<p class="image-container"><img alt="AWS リージョン" src="img/4d6dc0b22d51f468.png"></p>
<aside class="special"><p>デフォルトで 有効 になっているリージョンは有効にしたり無効にしたり変更ができません。</p>
</aside>
<p>アクションのカラムにある <strong>有効化</strong> をクリックして、</p>
<p class="image-container"><img alt="有効化" src="img/b1f9e43c8309ac5f.png"></p>
<p>メッセージを確認して、[ <strong>リージョンを有効化</strong> ] ボタンをクリックすると有効になります。</p>
<p class="image-container"><img alt="有効化" src="img/678a18f855773f58.png"></p>
<p>逆に無効にする場合は、<strong>無効化</strong> をクリックして、</p>
<p class="image-container"><img alt="無効化" src="img/90bf33890c27917f.png"></p>
<p>「<strong>無効化</strong>」と入力して、ボタンをクリックすれば無効化できます。</p>
<p class="image-container"><img alt="無効化" src="img/eee01226d3ec137a.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="セキュリティ強化 - MFA" duration="0">
        <p>AWS アカウントを契約した際のメールアドレスが、<strong>ルートアカウント</strong> になります。<br> ルートユーザーはアカウント内の全てのアクションを行うことができるので、アカウント内の神様とも言える権限があります。</p>
<p class="image-container"><img alt="ハッキング" src="img/4e74a8c72b4b6a45.png"></p>
<p>本ハンズオンでは、AWS アカウントの不正アクセスやアカウント乗っ取りなどの被害を防ぐため、<strong>多要素認証（MFA）</strong> を必須とさせていただいております。</p>
<p>ユーザー名とパスワードに加えて、一時的な認証コードである MFA を合わせることでセキュリティを大幅に強化できます。</p>
<p class="image-container"><img alt="ハッキング" src="img/6d96b93d915a21d7.png"></p>
<p>iPhone をご利用の方は App Store で、Android をご利用の方は Google Play で「Google Authenticator」と検索してインストールしてください。</p>
<h3 is-upgraded>Google Authenticator</h3>
<p class="image-container"><img alt="Google Authenticator" src="img/bc75d9962e237e3f.webp"></p>
<ul>
<li>Android の方：<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=ja&gl=US" target="_blank">Google Play</a></li>
<li>iPhone の方： <a href="https://apps.apple.com/jp/app/google-authenticator/id388497605" target="_blank">App Store</a></li>
</ul>
<aside class="warning"><p>ハンズオン終了後も、Google Authenticator は削除しないでください！ AWS アカウントにログインができなくなります。 </p>
</aside>
<aside class="special"><p>多要素認証 は Microsoft Authenticator や Authy などでも対応可能ですが、本ハンズオンでは環境を統一するために Google Authenticator にてご案内します。</p>
</aside>
<h2 is-upgraded>多要素認証の設定</h2>
<p>まとめますと、多要素認証は以下のために設定をします。</p>
<ul>
<li>アカウントの神様的権限を持つルートユーザーを盗られると大変</li>
<li>メールアドレス、パスワード以外にもログイン時に必要な情報を追加すべき</li>
</ul>
<p>AWS マネジメントコンソールを操作して、多要素認証を設定していきます。<br> 画面の右上にあるアカウント名をクリックして、[ <strong>セキュリティ認証情報</strong> ] をクリックします。</p>
<p class="image-container"><img alt="パスワード入力" src="img/8082551887818172.png"></p>
<p><strong>セキュリティ認証情報</strong> の画面に遷移するので、[ <strong>多要素認証 (MFA)</strong> ] にあります [ <strong>MFA の有効化</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="パスワード入力" src="img/c7ae85f8724687bf.png"></p>
<p><strong>MFA デバイスの管理</strong> のダイヤログ画面が表示されるので、<strong>○ 仮想 MFA デバイス</strong> が選択されていることを確認して、[ <strong>続行</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="パスワード入力" src="img/f7c0d4a393db69f0.png"></p>
<p><strong>MFA デバイスの設定</strong> の画面に遷移するので、[ <strong>QA コードの表示</strong> ] というリンクをクリックしてください。<br> QR コードが表示されます。</p>
<p class="image-container"><img alt="パスワード入力" src="img/142d3233004ec279.png"></p>
<p>お手元のスマホで Google Authenticator アプリを開き QR コードを読み込んでください。<br> 右下の [+] アイコンをタップして、</p>
<p class="image-container"><img alt="パスワード入力" src="img/b2d36986a135b6c3.png"></p>
<p>[QR コードをスキャン] をタップして、</p>
<p class="image-container"><img alt="パスワード入力" src="img/47789886e2dd718e.png"></p>
<p>スマホをパソコンの画面に表示されている QR コードに近づけて読み込んでください。ちょうど四角の部分に合わせるように読み込みます。</p>
<p class="image-container"><img alt="スマホで QR コードを読み込む" src="img/17db429bccff211c.png"></p>
<p>QR コードを読み込むと、コードが表示されます。<br> Google Authenticator から発行されたコードを 2 つ入力して、[ <strong>MFA の割り当て</strong> ] ボタンをクリックしてください。<br> まず、表示されたコードを <strong>MFA コード1</strong> に入力してください。<br> 一定時間が過ぎると別の MFA コードが表示されるので <strong>MFA コード2</strong> に入力してください。</p>
<aside class="special"><p>連続した 2 つのコードを入力する必要があります。コードが切り替わったタイミングで入力を始めるとスムーズに進めることができます。</p>
</aside>
<p class="image-container"><img alt="パスワード入力" src="img/b6ecaad5d9b8c95d.png"></p>
<p>以下のメッセージが表示されたら成功です。</p>
<p class="image-container"><img alt="パスワード入力" src="img/4a0928d516d2a3a.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="セキュリティ強化 - IAM ユーザー" duration="0">
        <h2 is-upgraded>ユーザーを追加しましょう</h2>
<p class="image-container"><img alt="パスワード入力" src="img/ecdbe83cb830a706.png"></p>
<p>先ほど MFA を設定したルートユーザーはアカウントの神様的存在ですので、普段は使わないことがベストプラクティスとして推奨されています。<br> 普段使うユーザーは IAM というサービスから作成できます。</p>
<p>IAM ユーザーも漏洩して不正利用されると権限によっては大きな被害を受けますので、MFA を設定してください。</p>
<h2 is-upgraded>AWS IAM とは</h2>
<p class="image-container"><img alt="IAM" src="img/13e48a597f9c9fc4.png"></p>
<p>AWS Identity and Access Management (IAM) は、誰がどのサービスやリソースに、どのような条件でアクセスできるかを指定することができる権限コントロールのためのサービスです。<br> 誰がどのような操作を行ったか証跡を取ることにも貢献します。</p>
<p>IAM には、大きく分けて 4 つの機能があります。</p>
<h3 is-upgraded><strong>ユーザーグループ</strong></h3>
<p>ユーザーをとりまとめるための機能です。<br> 会社で例えると、部、課、チームのような概念です。</p>
<h3 is-upgraded><strong>ユーザー</strong></h3>
<p>AWS を利用するユーザーを管理するための機能です。<br> アプリケーションに操作を委ねるアクセスキーも発行できます。<br> 会社で例えるなら社員や社員証といったところです。</p>
<h3 is-upgraded><strong>ロール</strong></h3>
<p>サーバーやプログラムに割り当てる権限情報です。<br> 会社で例えると、ID カードのようなものでしょうか。</p>
<h3 is-upgraded><strong>ポリシー</strong></h3>
<p>上記、グループ、ユーザー、ロールに付与する具体的な権限の内訳です。<br> 操作を許可したり、禁止したりできます。</p>
<h3 is-upgraded><strong>関係性</strong></h3>
<p class="image-container"><img alt="パスワード入力" src="img/28f7dffca5a0ad.png"></p>
<ol type="1">
<li>ポリシー A はユーザー A にのみ適用されます。</li>
<li>ポリシー B、C、D は、ユーザー A とユーザー B が含まれるグループに適用されます。</li>
<li>ポリシー E は、ロールにアタッチして、EC2 インスタンスにアタッチするとインスタンスにポリシー E の権限が付与できます。</li>
</ol>
<h2 is-upgraded>IAM ユーザーを作成する</h2>
<p>それでは、Administrator の権限を持つ IAM ユーザーを作成してみましょう。</p>
<p>IAM コンソールにアクセスしてください。<br> 検索ボックスに「iam」と入力して、候補をクリックするか、以下の URL をクリックして、CloudTrail コンソールにアクセスします。</p>
<p><a href="https://us-east-1.console.aws.amazon.com/iamv2/home" target="_blank">https://us-east-1.console.aws.amazon.com/iamv2/home</a></p>
<p class="image-container"><img alt="サービス検索" src="img/bb3d93fa7e64d21b.png"></p>
<p>IAM コンソールに画面が遷移したら、左側のメニューペインから <strong>ユーザー</strong> をクリックします。</p>
<p class="image-container"><img alt="IAM ユーザー" src="img/fef666b808ab4057.png"></p>
<p><strong>ユーザー</strong> の画面に遷移するので、[ <strong>ユーザーを追加</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="ユーザーを追加" src="img/ed6dbe41461e4abd.png"></p>
<p>ユーザー名は任意です。<br> 以下のような例に従って、ユーザーを作成してください。</p>
<p><strong>例1:</strong> handson_user<br><strong>例2:</strong> YamadaTaro</p>
<p><strong>パスワード - AWS マネジメントコンソールへのアクセス</strong> のチェックボックスにチェックを入れてください。<br> チェックを入れると、下部に <strong>コンソールのパスワード</strong> などが動的に表示されますが、変更せずに [ <strong>次のステップ: アクセス権限</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS CloudTrail" src="img/78b75c848858c4bf.png"><img alt="次のステップ: アクセス権限" src="img/783a5da89f9a1715.png"></p>
<p><strong>アクセス許可の設定</strong> に画面が遷移するので、[ <strong>既存のポリシーを直接アタッチ</strong> ] を選択し、検索ボックスに「AdministratorAccess」と入力します。<br> [ <strong>ENTER</strong> ] キーを押下すると、候補に「AdministratorAccess」が表示されるので、チェックボックスにチェックを入れて、 [ <strong>次のステップ: タグ</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="権限付与" src="img/f130f0a1dc6c1f6a.png"><img alt="タグ" src="img/5147f8468bf6bd25.png"></p>
<p><strong>タグの追加 (オプション)</strong> に画面遷移するので何も入力せずに、[ <strong>次のステップ: 確認</strong> ] ボタンをクリックします。<br><strong>確認</strong> 画面に遷移するので、内容に不備がないか確認して [ <strong>ユーザーの作成</strong> ] ボタンをクリックします。</p>
<aside class="special"><p>AdministratorAccess とは別に、IAMUserChangePassword が付与されています。IAMUserChangePassword は IAM ユーザーがパスワードを変更できる権限です。IAM ユーザー作成時に標準で授与されます。</p>
</aside>
<p class="image-container"><img alt="確認画面" src="img/75d8e95b22504d7e.png"><img alt="ユーザーを作成" src="img/213ab496e649d412.png"></p>
<p>ここで、必ず [ <strong>.csv のダウンロード</strong> ] ボタンをクリックして、認証情報をダウンロードしておいてください。<br> これがないと、ログインパスワードが分かりません。</p>
<p>ダウンロードができたら、[ <strong>閉じる</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="CSV をダウンロード" src="img/85bb3174d84a74fe.png"></p>
<p>作成したユーザー名をクリックしてください。</p>
<p class="image-container"><img alt="ユーザーリスト" src="img/f6d3cd24a374cf21.png"></p>
<h2 is-upgraded>MFA を有効化する</h2>
<p>ルートユーザー同様、作成したユーザーも乗っ取られると大変なことになります。<br> そのため、MFA を有効にしておきます。</p>
<p>[ <strong>認証情報</strong> ] タブを選択して、<strong>MFA デバイスの割り当て</strong> にある <strong>管理</strong> をクリックします。</p>
<p class="image-container"><img alt="ユーザーリスト" src="img/65d3eeea94610abb.png"></p>
<p><strong>MFA デバイスの管理</strong> のダイヤログ画面が表示されるので、[ <strong>仮想 MFA デバイス</strong> ] が選択されていることを確認して、[ <strong>続行</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="パスワード入力" src="img/f7c0d4a393db69f0.png"></p>
<p>Google Authenticator アプリを開き、で読み込んでください。右下の [+] アイコンをタップして、</p>
<p class="image-container"><img alt="パスワード入力" src="img/47789886e2dd718e.png"></p>
<p>Google Authenticator から発行されたコードを 2 つ入力して、[ <strong>MFA の割り当て</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="パスワード入力" src="img/b6ecaad5d9b8c95d.png"></p>
<p>以下のメッセージが表示されたら成功です。</p>
<p class="image-container"><img alt="パスワード入力" src="img/4a0928d516d2a3a.png"></p>
<p>MFA を有効化すると、以下のように MFA デバイスの割り当てが <strong>なし</strong> からリソース情報 (ARN といいます) に変わります。</p>
<p class="image-container"><img alt="MFA 有効済み" src="img/7cfe812ef5b458de.png"></p>
<aside class="special"><p>作成したユーザーはユーザー一覧のページから確認できます。</p>
</aside>
<p>ユーザー一覧のページ <a href="https://us-east-1.console.aws.amazon.com/iamv2/home#/users" target="_blank">https://us-east-1.console.aws.amazon.com/iamv2/home#/users</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="アカウントの確認とサインアウト" duration="0">
        <h2 is-upgraded>AWS アカウントの確認</h2>
<p>AWS アカウントは、数字 12 桁の数字で表現されます。<br> 画面上部でマイアカウントをクリックすると、確認できます。</p>
<p>次作業で必要ですので、メモをしておいてください。</p>
<h2 is-upgraded>サインアウト</h2>
<p>AWS マネジメントコンソールでの操作を終えたらサインアウトをします。 画面上部をクリックして、サインアウトを選択します。</p>


      </google-codelab-step>
    
      <google-codelab-step label="IAM ユーザーでサインインする" duration="0">
        <p>作成した IAM ユーザーでサインインしてみましょう。</p>
<p>以下 URL にアクセスするか、表示されているようであれば [もう一度ログインする] ボタンをクリックしてください。</p>
<p><a href="https://signin.aws.amazon.com/console" target="_blank">https://signin.aws.amazon.com/console</a></p>
<p>以下の画面に遷移しますので、[ <strong>○ IAM ユーザー</strong> ] が選択されていることを確認し、<strong>アカウント ID (12 桁)　またはアカウントエイリアス</strong> にアカウント ID を入力して、[ <strong>次へ</strong> ] ボタンをクリックしてください。</p>
<aside class="special"><p>アカウント ID を控えるのを忘れた方は届いたメールを確認するか、ルートアカウントでサインインして確認してください。</p>
</aside>
<p class="image-container"><img alt="IAM アカウントユーザー" src="img/c262338d9696d60c.png"></p>
<p>アカウント ID、ユーザー名、パスワードを入力する画面に遷移しますので、それぞれを入力してサインインしてください。</p>
<p class="image-container"><img alt="アカウント、ユーザー ID、パスワード" src="img/14a9e63f06ca9ba1.png"></p>
<aside class="special"><p>ユーザー名とパスワードは先ほどのIAM ユーザーを作成する手順でダウンロードした csv ファイルに記載されています。</p>
</aside>
<p>以下の画面が表示されたらサインイン成功です。</p>
<p class="image-container"><img alt="パスワード入力" src="img/45f4f24f8d787e82.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="オプション 1 AWS CloudTrail" duration="0">
        <p class="image-container"><img alt="AWS CloudTrail" src="img/30cd53aefaf9bb18.png"></p>
<h2 is-upgraded>CloudTrail の仕組み</h2>
<p>AWS の各種サービスは「マネージメントコンソール」、「AWS CLI」、「SDK」、「他AWSサービス」から操作ができますが、ほとんどは API エンドポイントへアクセスします。</p>
<p class="image-container"><img alt="API エンドポイントへアクセス" src="img/4fc93932935b93aa.png"></p>
<p>CloudTrail はこの AWS アカウント内で実行された API アクションを記録するサービスです。 例えば EC2 インスタンスを削除した場合だと以下などが把握できます。</p>
<ul>
<li><strong>Who?<br></strong> 誰が EC2 インスタンスを削除したか追跡できます。</li>
<li><strong>What?<br></strong> 何台の EC2 インスタンス削除したか追跡できます。</li>
<li><strong>Where？<br></strong> どこから削除の API が発信されたか？追跡できます。</li>
<li><strong>When？<br></strong> いつ削除の API が送信されたか？追跡できます。</li>
</ul>
<p>CloudTrail は有事の際に障害切り分けに利用できたり、不正アクセスかどうか判断する材料になったりと大変有効なサービスです。</p>
<h2 is-upgraded>無料枠で取得できないアクティビティ</h2>
<p>すべての管理イベント、データイベント、読み込み専用アクティビティを含むアカウントアクティビティの完全なレコードは CloudTrail の証跡を設定しなければ取得できません。</p>
<h2 is-upgraded>CloudTrail の料金</h2>
<p>CloudTrail はアカウントを作成した直後から有効になります。 証跡の取得自体は料金がかかりませんが、ログを S3 バケットに出力するため S3 バケットの料金がかかります。</p>
<p>詳細は以下サイトに記載されています。</p>
<p><a href="https://aws.amazon.com/jp/cloudtrail/pricing/" target="_blank">https://aws.amazon.com/jp/cloudtrail/pricing/</a></p>
<h2 is-upgraded>設定方法</h2>
<p>検索ボックスに「cloudtrail」と入力して、候補をクリックするか、以下の URL をクリックして、CloudTrail コンソールにアクセスします。</p>
<p><a href="https://ap-northeast-1.console.aws.amazon.com/cloudtrail/home?region=ap-northeast-1" target="_blank">https://ap-northeast-1.console.aws.amazon.com/cloudtrail/home?region=ap-northeast-1</a></p>
<p class="image-container"><img alt="サービス検索" src="img/dda8f22adbeece57.png"></p>
<p>リージョンが東京であることを確認します。</p>
<p class="image-container"><img alt="リージョン" src="img/9857c5367aee4d13.png"></p>
<p>左側にあるドロアーメニューをクリックし、メニューを展開します。</p>
<p class="image-container"><img alt="ドロアメニュー" src="img/82c8fa3dc975c376.png"></p>
<p>[ <strong>イベント履歴</strong> ] を表示をクリックします。</p>
<p class="image-container"><img alt="イベント履歴" src="img/26e38fff130b9e7f.png"></p>
<p><strong>＜注意＞</strong></p>
<ul>
<li>アカウントで行われたアクションが履歴として記録され一覧に表示されます。</li>
<li>履歴は 90 日分まで保持することができます。</li>
<li>90 日分以上履歴を残したい場合は、以降の作業が必要です。</li>
</ul>
<h2 is-upgraded>証跡の作成</h2>
<p>CloudTrail のコンソールに記載されている [ <strong>証跡の作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="イベント履歴" src="img/38f62dc7c1f9c4a5.png"></p>
<p>任意の証跡名を入力します。ここでは、management-events としています。<br> [ <strong>新しい S3 バケットを作成します</strong> ] が選択されていることを確認します。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/a6425b988556b504.png"></p>
<aside class="special"><p> Amazon S3 は定価コストで大量のデータを保存するのに適した AWS のオブジェクトストレージです。</p>
</aside>
<p><strong>証跡ログバケットおよびフォルダ</strong> は自動で入力されていますが、認識しやすいバケット名に変更もできます。</p>
<aside class="special"><p> 後ほど、Athena の手順で使用するので、S3 バケット名を控えておいてください。</p>
</aside>
<aside class="special"><p> ログファイルの SSE-KMS 暗号化のチェックボックスのチェックは、このハンズオンでは外しておいてください。</p>
</aside>
<p class="image-container"><img alt="イベント履歴" src="img/ec8a7189d0115e9e.png"></p>
<p>ページ下部にある [ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="イベント履歴" src="img/d258e9bb9974f19b.png"></p>
<p><strong>ログイベントの選択</strong> 画面に遷移しますので、何も変更せずに [ <strong>次へ</strong> ] ボタンをクリックします。　　</p>
<aside class="special"><p>S3 のダウンロードやアップロードの証跡を残したい場合は、データイベントにチェックを入れて下部に表示されたオプションを選択します。</p>
</aside>
<p>確認画面で [ <strong>証跡の作成</strong> ] ボタンをクリックすると S3 バケットに記録が保存されていきます。</p>


      </google-codelab-step>
    
      <google-codelab-step label="オプション 2 Budgets の設定" duration="0">
        <p class="image-container"><img alt="AWS CloudTrail" src="img/c59fe6e51af06941.png"></p>
<p>AWS Budgets を設定すると、AWS の予算設定ができます。<br> 例えば、事前に設定しておいた予算を超えると (あるいは超えそうになると) 通知したりできます。</p>
<p class="image-container"><img alt="アラーム通知" src="img/ef2a3488822be4d5.png"></p>
<aside class="warning"><p>リアルタイムではなく、1 日単位での評価になるのでご注意ください。</p>
</aside>
<aside class="warning"><p>Budgets は次に記載の設定をしないと IAM ユーザーがパスワードを変更できる権限から操作ができません。ルートユーザーにて実施をお願いします。</p>
</aside>
<h2 is-upgraded>IAM ユーザーが請求情報にアクセスできるようにするには？</h2>
<aside class="special"><p>ルートユーザーでログインしてください。ログイン方法は [4] サインイン をご確認ください。</p>
</aside>
<p>右上のアカウント名をクリックして、[ <strong>アカウント</strong> ] を選択します。</p>
<p class="image-container"><img alt="アカウント" src="img/c00f98d14e046bd9.png"></p>
<p>ページ中段にある <strong>IAM ユーザー/ロールによる請求情報へのアクセス</strong> にある「<strong>編集</strong>」ボタンをクリックします。</p>
<p class="image-container"><img alt="IAM ユーザー/ロールによる請求情報へのアクセス" src="img/c7c9fd4ec3bf7265.png"></p>
<p><strong>IAM アクセスのアクティブ化</strong> のチェックボックスにチェックを入れます。</p>
<p class="image-container"><img alt="IAM アクセスのアクティブ化" src="img/d20f561531d59663.png"></p>
<aside class="special"><p>有効になっていると、以下の通り [IAM ユーザー/ロールによる請求情報へのアクセスは有効になっています。] が表示されます。</p>
</aside>
<p class="image-container"><img alt="IAM アクセスのアクティブ化" src="img/5a5d4e0305ba6ed5.png"></p>
<p>上記の設定を行なうと、IAM ユーザーに Billing / Budget 権限が有効になっている場合に請求情報へアクセスができます。</p>
<aside class="special"><p>AdministratorAccess をアタッチしていると請求情報にアクセスできます。</p>
</aside>
<h2 is-upgraded>Budget 設定</h2>
<p>左側のメニューにある Budget をクリックし、[ <strong>予算を作成する</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Budgets メニュー" src="img/8f5c086a8e972a41.png"></p>
<p><strong>予算タイプを選択</strong> が表示されるので、<strong>コスト予算 – 推奨</strong> のまま、[ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="コスト予算 - 推奨" src="img/93569c0b9004397.png"></p>
<p><strong>詳細</strong> にある予算名に任意の名前をつけます。ここでは $20 としています。</p>
<p class="image-container"><img alt="予算名" src="img/248a2b2b2526f510.png"></p>
<p><strong>予算額を設定</strong> にある <strong>予算額 ($) を設定してください</strong> に 20.00 を設定します。</p>
<p class="image-container"><img alt="予算額を設定" src="img/4bf81edc5bd698ab.png"></p>
<p>その下に表示されている <strong>予算の範囲</strong> はデフォルトのままで OK です。</p>
<p class="image-container"><img alt="予算の範囲" src="img/43f18971a2108c13.png"></p>
<p>[ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="次へ" src="img/1f9c9aba645e8d3d.png"></p>
<p>[ <strong>アラートのしきい値を追加</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="アラートのしきい値を追加" src="img/843998f97f8cf659.png"></p>
<p>以下が展開するので、しきい値を 100 にし、通知する E メールを設定します。<br> [ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="アラートのしきい値を設定" src="img/f3c502040e6aebc4.png"></p>
<p>先ほどの <strong>Alert#1</strong> の画面に戻るので、[ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Alert#1" src="img/30d269de4d6ffbb4.png"></p>
<p>[ <strong>予算を作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Alert#1" src="img/d0884eb002117ee8.png"></p>
<p>これで、$20 を超えた場合にアラート通知されるようになります。</p>


      </google-codelab-step>
    
      <google-codelab-step label="オプション 3 Cost Explorer の設定" duration="0">
        <p class="image-container"><img alt="AWS CloudTrail" src="img/269cf697d327540b.png"></p>
<p>AWS Cost Explorer は AWS 料金の使用金額を確認するためのサービスです。<br> 24 時間単位で、その日時点の料金が確定しますので今日のハンズオンが終わってから、明日、明後日に料金が発生していないか確認をしてください。</p>
<p>左側のメニューペインから <strong>Cost Explorer</strong> をクリックし、[ <strong>Cost Explorer を起動</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS CloudTrail" src="img/249ed1a28d150bc5.png"></p>
<p>しばらくすると以下の画面になりますので、[ <strong>Cost Exlorer で表示</strong> ] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS CloudTrail" src="img/c61a9bc5feafc5bb.png"></p>
<p>[ <strong>自動選択:</strong> ] から、1 月間や、過去 6 ヶ月といった期間でコストの変動を確認できます。 また、[毎時、日別、月別] を選択してクローズアップした調査や、長期に渡っての確認が可能です。</p>
<p class="image-container"><img alt="ドロップダウンメニュー" src="img/2fd0a7846d53e865.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="オプション 4 サインインアラート の設定" duration="0">
        <p>Amazon Event Bridge を利用することで、AWS マネジメントコンソールにサインインしたタイミングで通知することができます。<br> アカウント情報の漏洩を素早く検知できると、不正利用や身に覚えのない高額請求を防ぐことができます。</p>
<p>ここでは、AWS マネジメントコンソールにサインインするとメール通知する仕組みを導入します。</p>
<h2 is-upgraded>Amazon SNS トピックを設定する</h2>
<p class="image-container"><img alt="Amazon Simple Notification Service (Amazon SNS)" src="img/2f5d97ebfbd88564.png"></p>
<p>メールの通知には SNS トピックが必要です。<br> EventBridge を設定する前に、SNS トピックを設定します。</p>
<p>検索ボックスに SNS と入力して <strong>Amazon Simple Notification Service</strong> を選択するか、<a href="https://us-east-1.console.aws.amazon.com/sns/v3/home" target="_blank">こちらの URL</a> にアクセスして、SNS コンソールを開きます。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/3b3a62c3c7380189.png"></p>
<p><strong>バージニア北部リージョン</strong> であることを確認して、異なる場合は移動してください。</p>
<aside class="special"><p>サインイン情報はバージニアリージョンに記録されます。</p>
</aside>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/882c329129a5885f.png"></p>
<p>ウェルカム画面が表示されたら、<strong>トピック名</strong> に任意のトピック名を入力して、[ <strong>次のステップ</strong> ] をクリックします。<br> ここでは、<strong>signin-topic</strong> にしました。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/daf49214652eaa47.png"></p>
<aside class="special"><p>過去にトピックを作成したことがある方は、トピック から [ トピックの作成 ] ボタンをクリックして進めてください。</p>
</aside>
<p><strong>トピックの作成</strong> に画面遷移するので、<strong>タイプ</strong> を <strong>スタンダード</strong> にして、<strong>名前</strong> に任意のトピック名が入力されているか確認します。<br> ここでは、<strong>signin-topic</strong> にしています。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/b784aedfb671ae75.png"></p>
<p>ページ下部の [ <strong>トピックの作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/3d469a17a8ddb71e.png"></p>
<h2 is-upgraded>トピックをサブスクライブする</h2>
<p>作成したトピックをサブスクライブすることで、メール通知を受けることができます。</p>
<p>左側のメニューから <strong>サブスクリプション</strong> をクリックして、[ <strong>サブスクリプションの作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/a4ff3bfef0bb3c96.png"></p>
<p><strong>トピック ARN</strong> で先ほど作成したトピックを選択します。<br><strong>プロトコル</strong> は <strong>E メール</strong> を選択します。<br><strong>エンドポイント</strong> はご利用のメールアドレスを入力します。<br> ページ下部の [ <strong>サブスクリプションの作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/c9a7f395ea0b5184.png"></p>
<p>以下のようなメールが届きますので、<strong>Confirm subscription</strong> のリンクをクリックします。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/71b00185014199ac.png"></p>
<p>以下、Subscription Confirmed! が表示されたら成功です。</p>
<p class="image-container"><img alt="Amazon Simple Notification Service" src="img/6d252ab380e463a4.png"></p>
<h2 is-upgraded>Amazon EventBridge の設定</h2>
<p>SNS の設定ができたら、EventBridge でサインインイベントのトリガーを作成していきます。</p>
<p class="image-container"><img alt="Amazon Event Bridge" src="img/4f68afa336ee350a.png"></p>
<p>検索ボックスに EventBridge と入力するか、<a href="https://us-east-1.console.aws.amazon.com/events/home?region=us-east-1#/" target="_blank">こちらの URL</a> にアクセスして、EventBridge コンソールを開きます。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/7975012fa393115a.png"></p>
<p><strong>バージニア北部</strong> リージョンであることを確認してください。</p>
<aside class="special"><p>サインイン情報はバージニアリージョンに記録されます。</p>
</aside>
<p class="image-container"><img alt="Amazon EventBridge" src="img/66d285c0cc3d510c.png"></p>
<p>[<strong>ルールを作成</strong>] ボタンをクリックして、</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/5f392ceb6233b7a9.png"></p>
<p>任意の名前を入力します。ここでは、<strong>signin-alarm</strong> としています。<br> [ <strong>次へ</strong> ] をクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/df190c99726a82d1.png"></p>
<p>ページが遷移したら、下部にある <strong>イベントパターン</strong> まで進み、<strong>AWS のサービス</strong> で [ <strong>AWS コンソールのサインイン</strong> ] を選択します。<br><strong>イベントタイプ</strong> が動的に表示されるので、<strong>サインインイベント</strong> を選択し、<strong>任意のユーザー</strong> にします。<br> [ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/6e39fc7ac44d7c32.png"></p>
<p><strong>ターゲットを選択</strong> の画面に遷移するので、[ <strong>○ AWS のサービス</strong> ] が選択されていることを確認して、<strong>ターゲットを選択</strong> から [ <strong>SNS トピック</strong> ] を選択し、<strong>トピック</strong> は先ほど作成した SNS トピック名を選択します。ここでは「<strong>singin-topic</strong>」を選択します。<br> [ <strong>次へ</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/9c4d79b37eaddaf2.png"></p>
<p><strong>タグを設定 - オプション</strong> の画面に遷移しますので、[ <strong>次へ</strong> ] ボタンをクリックします。<br><strong>レビューと作成</strong> 画面に遷移しますので、内容を確認して下部の [ <strong>ルールの作成</strong> ] ボタンをクリックします。</p>
<p>サインインすると以下のようなメール通知が届きます。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/a29f1ecf78023d89.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="CloudTrail を Athena で検索する" duration="0">
        <p class="image-container"><img alt="Amazon EventBridge" src="img/a6425b988556b504.png"></p>
<p>オプション 1 で AWS CloudTrail に証跡を設定すると、S3 バケットにログが出力されていきます。<br> ただ、S3 バケットに保存されたファイルは .gz ファイルに圧縮されており、</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/ddc207ebc1ac04b1.png"></p>
<p>ファイルには、以下のように JSON 形式で記録されています。<br> これらのファイルを一つ一つダウンロードして確認するのは効率が悪いです。</p>
<pre><code language="language-json" class="language-json">{
    &#34;Records&#34;: [
        {
            &#34;eventVersion&#34;: &#34;1.08&#34;,
            &#34;userIdentity&#34;: {
                &#34;type&#34;: &#34;AWSService&#34;,
                &#34;invokedBy&#34;: &#34;cloudtrail.amazonaws.com&#34;
            },
            &#34;eventTime&#34;: &#34;2022-07-31T23:58:42Z&#34;,
            &#34;eventSource&#34;: &#34;s3.amazonaws.com&#34;,
            &#34;eventName&#34;: &#34;GetBucketAcl&#34;,
            &#34;awsRegion&#34;: &#34;ap-northeast-1&#34;,
            &#34;sourceIPAddress&#34;: &#34;cloudtrail.amazonaws.com&#34;,
            &#34;userAgent&#34;: &#34;cloudtrail.amazonaws.com&#34;,
(以下省略)
</code></pre>
<p>そこで、Amazon Ahena を利用して s3 バケットに複数のファイルとして保存されたログをまとめて横串で検索する方法をご紹介します。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/299de8052e98fc49.png"></p>
<p>Amazon Athena は S3 バケットに保存されたデータに対して、直接クエリを実行してデータを抽出できるサービスです。<br> クエリ結果は結果用の S3 バケットに保存されます。まずは、Athena を実行するために、結果保存用バケットを設定します。</p>
<h2 is-upgraded>Athena のクエリ結果を保存するバケットを作成</h2>
<p>検索ボックスにて s3 と入力して、S3 をクリックするか、<a href="https://s3.console.aws.amazon.com/s3/home?region=ap-northeast-1" target="_blank">こちら</a> をクリックして、Amazon S3 コンソールを開きます。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/c68a271ba40bccb6.png"></p>
<p>[ <strong>バケットを作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/ff7ff911118f8811.png"></p>
<p><strong>バケットを作成</strong> 画面に遷移するので、任意のバケット名を入力します。<br> ここでは、handson-athena-result-20220814 を指定しましたが、handson-athena-result-＜お名前＞ をお勧めします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/b5944226c2ca0167.png"></p>
<p>バケット名が入力できたら、画面下部の [ <strong>バケットを作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/549f99fd28d4fb0.png"></p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/30cd53aefaf9bb18.png"></p>
<p>CloudTrail を開き、左側のメニューから <strong>イベント履歴</strong> をクリックします。<br> 右側にある [ <strong>Athena テーブルを作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/804b238672cdd058.png"></p>
<p>すると、<strong>Amazon Athena でテーブルを作成</strong> 画面に遷移します。<br><strong>ストレージの場所</strong> は、先の手順で設定した証跡用のバケットを指定します。<br> [ <strong>テーブルを作成</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/6bb1320a6899b693.png"></p>
<p>検索ボックスに athena と入力すると、候補に <strong>Athena</strong> が表示されるので、選択するか <a href="https://ap-northeast-1.console.aws.amazon.com/athena/home?region=ap-northeast-1#/" target="_blank">こちら</a> をクリックして、Athena コンソールにアクセスします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/4e168176d487eff3.png"></p>
<p>左側のメニューから <strong>クエリエディタ</strong> をクリックすると、先ほどの CloudTrail での操作でテーブルが作成されているのが確認できます。<br> Athena の検索結果を s3 バケットに保存できないと Athena はクエリを実行できませんので、</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/e99ab46eda7e9e4a.png"></p>
<p>表示されているメッセージにある [ <strong>設定を表示</strong> ] ボタンをクリックします。<br> メッセージが表示されない方は [ <strong>設定</strong> ] タブをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/f487d638fcefd5da.png"></p>
<p>[ <strong>管理</strong> ] ボタンをクリックして、</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/361ed9a4a1d7456.png"></p>
<p>クエリ結果の場所に先ほど作成した s3 バケットを指定します。<br> [ <strong>保存</strong> ] ボタンをクリックします。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/40d8726c518207bd.png"></p>
<p>設定できると以下のようにバケットのパスが設定されます。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/81efa8d06b085d73.png"></p>
<p>Athena を実行する準備が整いましたので、試しに以下 SQL 文をコピペして実行してみてください。</p>
<aside class="special"><p>FROM 句にある &lt;テーブルとビューのテーブルに表示されているテーブル名&gt; を書き換えてから実行してください。</p>
</aside>
<pre><code language="language-sql" class="language-sql">SELECT
 useridentity.arn,
 eventname,
 sourceipaddress,
 eventtime
FROM &lt;テーブルとビューのテーブルに表示されているテーブル名&gt;
LIMIT 100;
</code></pre>
<p>[ <strong>実行</strong> ] ボタンをクリックして以下のように結果が表示されれば成功です。</p>
<p class="image-container"><img alt="Amazon EventBridge" src="img/132e3a192b191d09.png"></p>
<p>各カラムの意味は以下の通りです。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>項目名</p>
</td><td colspan="1" rowspan="1"><p>説明</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>arn</p>
</td><td colspan="1" rowspan="1"><p>Amazon Resource Name (リソース名)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>eventname</p>
</td><td colspan="1" rowspan="1"><p>イベント名</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>sourceipaddress</p>
</td><td colspan="1" rowspan="1"><p>実行元の IP アドレス</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>eventtime</p>
</td><td colspan="1" rowspan="1"><p>イベントの日時</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="その他 追加情報" duration="0">
        <ol type="1">
<li>MFA デバイスが故障または紛失した場合のセルフサービスによるリセットの方法<br><a href="https://aws.amazon.com/jp/blogs/news/how-to-reset-mfa-token/" target="_blank">https://aws.amazon.com/jp/blogs/news/how-to-reset-mfa-token/</a></li>
<li>AWS SSO の MFA で Macbook の TouchID (指紋センサー) を使う方法<br><a href="https://dev.classmethod.jp/articles/multi-factor-authentication-with-webauthn-for-aws-sso/" target="_blank">https://dev.classmethod.jp/articles/multi-factor-authentication-with-webauthn-for-aws-sso/</a></li>
</ol>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
